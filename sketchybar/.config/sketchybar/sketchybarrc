# https://felixkratz.github.io/SketchyBar/config/
PLUGIN_DIR="$CONFIG_DIR/plugins"
source "$CONFIG_DIR/utils.sh"
source "$CONFIG_DIR/rose_pine_colors.sh"

FONT_SIZE=14.0
LABEL_PAD=2

sketchybar --bar position=left \
  height=70 \
  blur_radius=30 \
  color=$ROSE_PINE_BASE \
  border_color=$ROSE_PINE_LOVE \
  border_width=1 \
  margin=5 \
  y_offset=12 \
  corner_radius=15 \

default=(
    padding_left=5
    padding_right=5
    icon.font="Monaspace Neon NF:regular:$FONT_SIZE"
    label.font="Monaspace Neon NF:regular:$FONT_SIZE"
    label.color=$ROSE_PINE_TEXT
    label.padding_left=$LABEL_PAD
    label.padding_right=$LABEL_PAD
)
sketchybar --default "${default[@]}"

sketchybar \
    --add item clock left \
    --set clock \
    update_freq=10 \
    icon.drawing=off \
    label.font.size=$FONT_SIZE \
    script="$PLUGIN_DIR/clock.sh"

sb_separator left 16 16

sketchybar \
    --add item day left --set day update_freq=120 label="$(date '+%a')" \
    --add item date left --set date update_freq=120 label="$(date '+%d' | sed s/^0//)" \
    --add item month left --set month update_freq=120 label="$(date '+%b')"

sb_separator left 16 16

SPACE_TEXTS=("code" "net" "misc" "chat" "call" "music" "notes" "8" "9" "10")
for i in "${!SPACE_TEXTS[@]}"
do
    sid="$(($i+1))"
    space=(
        space="$sid"
        label="${SPACE_TEXTS[i]}"
        script="$PLUGIN_DIR/space.sh"
    )
    sketchybar --add space space."$sid" left --set space."$sid" "${space[@]}"
done

sketchybar --add item volume right \
    --set volume script="$PLUGIN_DIR/volume.sh" \
                 click_script="osascript -e 'set volume output muted not (output muted of (get volume settings))'" \
    --subscribe volume volume_change

sketchybar --add item battery right \
    --set battery update_freq=30 script="$PLUGIN_DIR/battery.sh" \
    --subscribe battery system_woke power_source_change

sb_separator right 16 16

sketchybar --update
